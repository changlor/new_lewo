<?php
namespace Home\Model;
use Think\Model;
/**
* [房间数据层]
*/
class RoomModel extends Model{
	/**
	* [入住成功后修改房间状态]
	**/
	public function setRoomStatus($id,$status){
		return $this->where(array("id"=>$id))->save(array("status"=>$status));
	}
	/**
	* [入住成功后修改房间居住人]
	**/
	public function setRoomPerson($id,$account_id){
		return $this->where(array("id"=>$id))->save(array("account_id"=>$account_id));
	}
	/**
	* [根据用户id获取租客房间信息]
	**/
	public function getRoomInfoByAcId($id){
		return $this->where(array("account_id"=>$id,"status"=>2))->find();
	}
	/**
	 * [获取房间/床位信息]
	 **/
	public function getRoom($id){
		$MRoom = M("room");
		$MHouses = M("houses");
		$MSteward = M("admin_user");
		$room_info = $MRoom->where(array('id'=>$id))->find();
		$house_info = $MHouses->field("area_id,address,floor,door_no,building,steward_id")->where(array('house_code'=>$room_info['house_code']))->find();
		$steward_info = $MSteward->field("id,username,nickname,mobile")->where(array('id'=>$house_info['steward_id']))->find();
		$room_info['area_name'] = M("area")->where(array("id"=>$house_info['area_id']))->getField("area_name");
		if ( !empty($room_info['room_images_01']) ) {
			$room_info['room_images'][] = $room_info['room_images_01'];
		}
		if ( !empty($room_info['room_images_02']) ) {
			$room_info['room_images'][] = $room_info['room_images_02'];
		}
		if ( !empty($room_info['room_images_03']) ) {
			$room_info['room_images'][] = $room_info['room_images_03'];
		}
		if ( !empty($room_info['room_images_04']) ) {
			$room_info['room_images'][] = $room_info['room_images_04'];
		}

		$room_info['house_info'] = $house_info;
		$room_info['steward_info'] = $steward_info;
		$room_info['address'] = $house_info['address'];
		return $room_info;
	}
	/**
	* [获取该房间的人数]
	**/
	public function getRoomPersonByCode($room_code){
		return $this->where(array("status"=>2,"room_code"=>$room_code))->count();
	}
}

?>