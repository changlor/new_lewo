<?php
namespace Home\Model;
use Think\Model;
/**
* [账单数据层]
*/
class ChargeBillModel extends Model{
	/**
    * [获取该用户id的账单列表]
    **/
    public function getBillByAcId($account_id){
        $list = $this->where(array("account_id"=>$account_id))->select();
        foreach ($list AS $key=>$val) {
	        switch ($val['type']) {
				case 1:
					$list[$key]['type_name'] = "日常";
					break;
				case 2:
					$list[$key]['type_name'] = "退租";
					break;
			}
            $list[$key]['bill_info'] = $val['input_year']."年".$val['input_month']."月".$list[$key]['type_name']."账单";
		}
		return $list;
    }
    /**
    * [获取该账单信息]用户账单页面
    **/ 
    public function getDetailBillById($id){
    	$lsit = $this->field()->where(array("id"=>$id))->find();
    	$DRoom = D("room");
		$DAccount = D("account");
		$DArea = D("area");
		$DContract = D("contract");
    	return $lsit;
    }

    /**
    * [获取该租客未支付账单]
    **/
    public function getNotPay($account_id){
    	$list =  $this->where(array("account_id"=>$account_id,"pay_status"=>0))->select();
    	foreach ($list AS $key=>$val) {
    		$startdate=time();
			$enddate=strtotime($val['should_pay_date']);
			$days=round(($enddate-$startdate)/86400)+1;
    		$list[$key]['days'] = $days;
	        switch ($val['type']) {
				case 1:
					$list[$key]['type_name'] = "日常";
					break;
				case 2:
					$list[$key]['type_name'] = "退租水电气";
					break;
			}
            $list[$key]['bill_info'] = $val['input_year']."年".$val['input_month']."月".$list[$key]['type_name']."账单";
		}
		return $list;
    }

    /**
    * [修改支付][1支付宝][2微信][3余额抵押]
    **/
    public function setPayStatus($charge_id,$pay_type){
    	return $this->where(array("id"=>$charge_id))->save(array("pay_type"=>$pay_type));
    }
}

?>