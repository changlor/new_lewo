<?php
/**
*
* 公共函数
*
**/
/**
* [获取电费]
* @param add_energy 增加的度数
* @param energy_stair 阶梯算法
* @return 电费
**/
function get_energy_fee($add_energy,$energy_stair){
	$energy_fee = 0;
	foreach ( $energy_stair AS $k=>$v ) {
        if ( $add_energy > $v['0'] ) { //是本阶
            if ( $add_energy >= $v['1'] ) { //超于本阶的度数
                $energy_fee += ( $v['1'] - $v['0'] ) * $v['2']; //本阶的度数 * 本阶单价
            } else {
                $this_add_energy = $add_energy - $v['0']; //本阶增加的度数
                $energy_fee += $this_add_energy * $v['2'];
            }
        }
    }
    return $energy_fee;
}

/**
* 创建唯一的账单号
**/
function getOrderNo(){
	return date('Ymds') . str_pad(mt_rand(1, 99999), 5, '0', STR_PAD_LEFT);
}

/**
* [判断是否微信浏览器]
**/
function is_weixin(){
    if ( strpos($_SERVER['HTTP_USER_AGENT'], 'MicroMessenger') !== false ) {
            return true;
    }  
    return false;
}

/**
* [获取某天签约合同的金额]
**/
function getTotalMoney($date){
	$MContract = M("contract");
	$sum_rent = $MContract->where(array("start_time"=>$date))->sum("rent");//租金
	$sum_fee = $MContract->where(array("start_time"=>$date))->sum("fee");//服务费
	$sum_deposit = $MContract->where(array("start_time"=>$date))->sum("deposit");//押金
	return $sum_fee+$sum_deposit+$sum_rent;
}

/**
* [获取某天签约的个数]
**/
function getSignCount($date){
	return M("contract")->where(array("start_time"=>$date))->count();
}

/**
* [获取某天缴定个数]
**/
function getJDCount($date){
	return M("schedule")->where(array("create_date"=>$date,"schedule_type"=>4))->count();
}

/**
* [获取某天总缴定金额]
**/
function getJDMoney($date){
	$sum_money = M("schedule")->where(array("create_date"=>$date,"schedule_type"=>4))->sum("money");
	return empty($sum_money)?0:$sum_money;
}	

/**
* [获取房间总数]
**/
function getRoomCount(){
	return M("room")->where(array("room_type"=>1,"is_show"=>1))->count();
}
/**
* [获取房间空置率和空置数]
**/
function getEmptyRoomCount(){
	return M("room")->where(array("status"=>0,"room_type"=>1,"is_show"=>1))->count();
}
/**
* [获取床位总数]
**/
function getBedCount(){
	return M("room")->where(array("room_type"=>2,"is_show"=>1))->count();
}
/**
* [获取床位空置率和空置数]
**/
function getEmptyBedCount(){
	return M("room")->where(array("status"=>0,"room_type"=>2,"is_show"=>1))->count();
}
?> 