<?php
namespace Admin\Model;
use Think\Model;
/**
* [合同数据层]
*/
class ContractModel extends Model{
	/**
	* [根据用户id和房间id获取合同]
	**/
	public function getContract($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->find();
	}
	/**
	 * [合同表]
	 **/
	public function isDateCheckInByDate($account_id,$room_id,$year,$month){
        $ht_info = $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->find();
        $ht_year = date("Y",strtotime($ht_info['start_time']));
        $ht_month = date("m",strtotime($ht_info['start_time']));
        if ( $ht_year == $year && $ht_month == $month ) {
        	return true;
        } else {
        	return false;
        }
	}
	/**
	* [获取合同人数]
	**/
	public function getPersonCount($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->getField("person_count");
	}
	/**
	* [获取合同租期开始时间]
	**/
	public function getContractStartDate($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->getField("start_time");
	}
	/**
	* [获取合同租期结束时间]
	**/
	public function getContractEndDate($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->getField("end_time");
	}
	/**
	* [获取缴费周期]
	**/
	public function getPeriod($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->getField("period");
	}
	/**
	* [获取押金]
	**/
	public function getDeposit($account_id,$room_id){
		return $this->where(array("account_id"=>$account_id,"room_id"=>$room_id))->getField("deposit");
	}
	/**
	* [获取合同列表]
	**/
	public function getContractList(){
		$list = $this->order("create_time desc")->select();
		$DAccount = D("account");
		$DRoom = D("room");
		foreach ( $list AS $key=>$val ) {
			$list[$key]['realname'] = $DAccount->getFieldById($val['account_id'],"realname");
			$list[$key]['mobile'] = $DAccount->getFieldById($val['account_id'],"mobile");
			$list[$key]['room_info'] = $DRoom->getRoomById($val['room_id']);
			$list[$key]['year'] = date("Y",strtotime($val['start_time']));
			$list[$key]['month'] = date("m",strtotime($val['start_time']));
			$rent_type = explode("_", $val['rent_type']);
			$list[$key]['rent_type_name'] = "押".$rent_type['0']."付".$rent_type['1'];
			$list[$key]['contract_status_name'] = C("contract_status_arr")[$val['contract_status']];
		}
		return $list;
	}
}

?>